# Null과 Null safety


![Null 타입과 Null safety](../../images/02_05_null.png)


>“천재는 노력하는 사람을 이길 수 없고, 노력하는 사람은 즐기는 사람을 이길 수 없다.” — 공자

변수에 대해서 배웠으니, 이번에는 특별한 값을 할당하는 방법을 배워보자. 바로 null 이라는 값이다. null은 값이 없음을 나타내는 특별한 값이다.

## 값이 없는 값
사실 null의 의미를 정확히 설명하기 위해서는 현실 세계의 적당한 비유를 찾기 어렵다. null은 프로그래밍 언어 안에서만 존재하는 특별한 개념으로, “값이 존재하지 않음을 명시하는 하나의 값”이다. 다시 말해, null은 실제로 “아무것도 없는 상태” 을 나타내기 위한 하나의 약속된 표시 인것이다.

```dart
var a = null; // a라는 변수에 null 값을 할당한다.
```

즉 null은 일종의 값이며, 별도의 Null 이라는 타입을 가진다. (아래는 이해를 돕기 위해 작성한 예제 이지만, 실제 개발에서는 이렇게 직접 Null 타입을 직접 선언하는 경우는 드물다.)

```dart
Null b = null;
```


## null의 필요성

프로그래밍을 하다 보면, 상황에 따라 어떤 변수에 값이 존재할 수도 있고, 존재하지 않을 수도 있다. 만약 null이라는 특별한 값을 사용할 수 없다면, 우리는 값이 없음을 나타내기 위해 숫자 0이나 빈 문자열('') 같은 임시 수단을 사용할 수밖에 없다. 그러나 이러한 방식은 근본적인 문제가 있다. 0은 실제로 존재하는 숫자 값이며, 빈 문자열 역시 길이가 0인 문자열 값입니다. 즉, 이들은 ‘아무 값도 없음’을 표현하기에는 적절하지 않다. 단순히 비어 있는 것이 아니라, 아직 값이 정해지지 않았거나, 존재하지 않는 상태 자체를 표현할 수 있는 별도의 기호, 즉 null 같은 개념이 필요한 것이다.


```dart
String? a = null; //초기값은 null로 지정
//...
main(){ //실행시점에 값을 다시 할당해서 사용
	a = "홍길동"; //필요할 때 값을 할당
	print(a); // "홍길동" 출력
}
```



위 예제를 자세히 살펴보면 낯선 기호가 하나 보인다. 바로 물음표(?)이다. (이 물음표는 오타가 아니다.)Dart에서는 타입 이름 뒤에 ?를 붙이면, 해당 변수에 null 값을 할당할 수 있다는 의미가 된다. 즉, 이 변수는 String 타입일 수도 있고, null일 수도 있다는 뜻이다. 이는 String뿐만 아니라 모든 데이터 타입에 동일하게 적용된다.

```dart
String? a = null; // String 타입의 변수 a는 null 값을 가질 수 있다.
int? b = null; // int 타입의 변수 b도 null 값을 가질 수 있다.
```

사실 위 코드에서 String? 타입의 변수에 굳이 null을 명시적으로 할당할 필요는 없다. ?를 붙여 Nullable 타입으로 선언하는 순간, 해당 변수는 null 값을 가질 수 있는 상태가 되며, 별도로 값을 초기화하지 않으면 기본적으로 null 로 자동 초기화된다. 이러한 동작은 Dart의 null-safety 규칙에 따른 기본 동작이다.

```dart
String? a;
int? b;
```

### AI와 함께 학습하세요.
>Q. 값이 없음을 나타내는 'Null' 이라는 개념은 언제 어디서부터 사용된거야?


## null safety 코드 작성
null과 관련된 오류를 막기 위해 null-safety라는 규칙이 도입되었다. 이는 null 값에 대한 사용을 엄격히 제한하여, 프로그램 실행 중 발생할 수 있는 null 오류 가능성을 낮추기 위한 하나의 전략이다. 

최신 프로그래밍 언어들은 대부분 null-safety 기능을 기본으로 탑재하고 있으며, 그만큼 null 값은 편리하지만 신중하게 다루어야 할 중요한 요소이다. null-safety를 적용하면 컴파일 시점에 해당 값이 null 인지 아닌지를 명확히 구분할 수 있다. 이를 통해 런타임(실행 시점)에서 발생할 수 있는 오류를 사전에 차단하고, 프로그램의 안정성을 크게 높일 수 있다.

Dart에서는 기본적으로 모든 변수는 non-nullable 이다. 즉, 별도로 ? 표시하지 않는 한, 변수에는 null 값을 담을 수 없다. 필요할 경우에만 ? 기호를 붙여 nullable로 명시적으로 선언해야 한다.

```dart
int a = null; // a는 null을 가질 수 없다. = 컴파일 오류 발생
```

처음에는 null을 사용할 필요가 없다고 생각할 수 있다. 하지만 실제로 개발을 하다 보면, 특정 상황에서 아직 값이 정해지지 않은 상태를 명확히 표현해야 할 때가 있다. 바로 이러한 경우에 ? 기호를 활용하여 변수를 nullable 타입으로 선언하면 된다.

```dart
int a = 0; // a는 null값을 할당할수 없다.
int? b = 5; // b는 null을 가질 수 있다.
//...
b = null; // 로직에 의해 값이 5에서 null 로 변경되었다.
```

그렇다면 null을 할당한 변수를 실제로 사용할 때, 이 변수가 null인지 아닌지를 어떻게 확인할 수 있을까? 값이 들어 있다고 믿고 접근했다가, 실제로는 null인 상태에서 속성이나 메서드를 호출하면 런타임 오류가 발생할 수 있기 때문에 주의해야한다. 이러한 문제를 방지하기 위해 Dart에서는 ?., ??, ??=, ! 와 같은 null 안전 연산자(null-safe operator) 를 제공한다. 이 연산자들은 처음 접할 때 다소 생소하게 느껴질 수 있지만, 익숙해지면 간결한 문법으로 null 여부를 검사하고 안전하게 값을 처리할 수 있는 매우 강력한 도구가 된다.

고전적인 방법으로는 (null-safety가 도입되기 전) null 검증을 위해서 반드시 아래와 같은 조건문(아직 배우지 않았지만 눈에 익히도록 하자)을 사용해야 했다. null 여부를 일일이 조건문으로 검사하는 방식은 코드가 장황해지고, 실수로 빠뜨리는 경우가 생기기 쉽다. 실제로 프로젝트 전체에 이런 if 문이 널려 있는 경우도 흔하다.(이 방식이 나쁘다는 이야기가 아니다.)

```dart
var a = 2;
if (a != null) { //null이 아니라면
	 print(a);
}
```

null-safe 연산자를 사용하면 이런 복잡한 조건식을 간단하고 직관적으로 대체해 준다.

**?. 연산자**

```dart
int? b = 5; // b는 null이 될 수도 있는 int 타입 변수이다.
print(b?.isEven); //만약 b가 null이 아니면 isEven 값을 반환한다.
```

?. 연산자는 해당 값이 null인지 먼저 확인한 후, 속성이나 메서드를 호출하는 안전한 접근 방식이다. 위 예제에서 b가 null이 아닐 경우에만 .isEven 속성을 호출하며, 만약 b가 null이라면 아무 동작도 하지 않고 그대로 null을 반환한다.

>**[팁&노트]**
isEven은 Dart의 int 타입에 내장된 속성으로, 해당 숫자가 짝수이면 true, 홀수이면 false를 반환한다.

**??연산자**

```dart
int? c; // ?타입으로 선언된 변수, 초기값은 자동으로 null 이다.
int d = c ?? 0; // 만약 c가 null이면 0을 반환하고, null이 아니면 c의 값을 반환한다.
```

?? 연산자는 왼쪽 값이 null이면 오른쪽 값을 대신 사용하는 연산자이다. 위 코드에서는 c가 null이기 때문에 d에 0이 대입된다.

**??= 연산자**

```dart
int? e; //역시 초기값은 null 이다.
e ??= 10; // e가 null이면 10을 할당한다.
```

??= 연산자는 변수가 null일 때만 오른쪽 값을 할당하는 연산자이다. 현재 e는 null이기 때문에 10이라는 값이 e에 할당된다. 만약 e가 이미 어떤 값이 있었다면(null이 아닌) 기존 값이 유지되고 변경되지 않는다.

**! (느낌표) 연산자**

```dart
int? f = 5; // f는 null이 될 수도 있는 int 타입 변수이다.
int g = f!; // f가 null이 아님을 확신하고 사용한다.
```

! (느낌표)는 이 변수는 절대 null 이 아니다 라고 개발자가 직접 보증할 때 사용한다. 위 코드에서는 f가 5라는 값을 가지고 있기 때문에 g에 정상적으로 5가 할당된다. 그런데 만약 f가 null 이었는데도 !를 이용해 null이 아님을 강제할때는 런타임 오류가 발생하게 된다. !사용시 주의가 필요하다.


## null-safety의 목표
우리의 목표는 null 자체를 없애는 것이 아니라 null을 안전하게 사용하는 것이다. null-safety 를 적용함으로써, null과 관련된 오류 발생을 줄이고 전체 코드의 안정성을 높이는 것이 중요하다. 
결국 우리는, null safety를 통해 예측 가능하고 신뢰할 수 있는 프로그램을 만드는 것에 목표를 두어야한다.


### AI와 함께 학습하세요
>Q. dart의 null과 null-safety에 대해서 공부중이야.null-safety 연산자를 통해 코드를 작성하는 예제를 제공해줘.

---


## **심화학습**
**“왜 이런 복잡한 규칙이 필요 했을까?”**
null 값은 프로그래밍 세계에서 굉장히 유용하지만, 동시에 중대한 문제점을 내포하고 있다. null은 값이 존재하지 않음을 명시할 수 있는 유일한 수단이지만, 이를 적절하게 검사하거나 처리하지 않을 경우, 프로그램이 예기치 않게 중단되거나 심각한 오류를 발생시킬 수 있기 때문이다.

예를 들어, 어떤 변수에 null이 들어 있는데 이를 확인하지 않고 이값을 사용하려고 한다면(값이 들어있다고 판단하여), 런타임에서 null 참조 예외(null reference error) 가 발생합니다. 이는 프로그램을 강제 종료시키거나, 데이터가 손실되는 경우로 이어질수 있다.

실제로도 수 많은 소프트웨어 오류중 대부분은 null을 적절히 처리하지 못해 발생했으며, 이로 인해 막대한 유지보수 비용과 장애 대응 비용이 들었다.

>**[팁&노트]**
2009년 소프트웨어 컨퍼런스에서 토니 호어는 Null참조를 "발명"한 것에 대해 사과했다. 나는 그것을 10억 달러의 실수라고 부른다. 그것은 1965년에 무효 참조의 발명이었다. 그 당시, 나는 객체 지향 언어(ALGOL W)의 참조를 위한 최초의 포괄적인 유형 시스템을 설계하고 있었다. 내 목표는 컴파일러가 자동으로 검사를 수행하면서 참조의 모든 사용이 절대적으로 안전해야 한다는 것을 보장하는 것이었다. 하지만 나는 구현하기가 너무 쉬웠기 때문에 무효 참조를 넣으려는 유혹을 참을 수 없었다. 이것은 수많은 오류, 취약점 및 시스템 충돌로 이어졌고, 이는 아마도 지난 40년 동안 10억 달러의 고통과 피해를 초래했을 것이다. [^1]


---

## Copilot 활용 실습

우리는 프로그램을 처음 설계하며, 아직 값이 정해지지 않은 변수들을 선언하려고 한다. 사용자 입력, 네트워크 응답처럼 나중에 값이 들어올 수도 있는 상황을 가정하고, 다양한 방식으로 null을 다뤄보는 연습을 해보자. Dart의 null 처리 방식과 nullable(null이 가능한) 타입 선언을 직접 작성해보고, Copilot의 제안을 활용해 각 줄을 채워보자.


```dart
void main() {
  // 1) var 키워드로 변수 a를 선언하고, null 할당한다.
  // var a = ...;

  // 2) 문자열 타입의 변수 b를 선언하고 null 할당한다.
  // 추가로 다른 타입의 변수도 선언해보자.
  // String? b = ...;
  // int? c = ...;
  // ...

  // 3) 변수 d의 값은 나중에 사용(출력)할 예정이다.
  // 먼저 null로 초기화한 후, 이후에 다른 값을 할당해보자.
  // String? d;
  // d = ...;
  // print(d); 
}
```


---
[^1] [wikipedia:Null참조] (https://en.wikipedia.org/wiki/Null_pointer)